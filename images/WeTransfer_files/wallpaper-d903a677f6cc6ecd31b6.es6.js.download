(window.webpackJsonp=window.webpackJsonp||[]).push([[60],{1184:function(e,t,a){},1210:function(e,t,a){"use strict";a.r(t),a.d(t,"default",(function(){return X}));var r=a(2),n=a.n(r),o=a(209),i={creative:null,error:!1,blockedByClient:!1,isAdvertisingEnabled:!1,isHidden:!1,isRotationEnabled:!1,isRotationPaused:!1,position:0,providerName:null};function s(e,t){var a=Object.keys(e);if(Object.getOwnPropertySymbols){var r=Object.getOwnPropertySymbols(e);t&&(r=r.filter((function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable}))),a.push.apply(a,r)}return a}function l(e){for(var t=1;t<arguments.length;t++){var a=null!=arguments[t]?arguments[t]:{};t%2?s(Object(a),!0).forEach((function(t){n()(e,t,a[t])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(a)):s(Object(a)).forEach((function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(a,t))}))}return e}function p(e=i,t){const{type:a}=t;switch(a){case o.a.ROTATE_WALLPAPER:return l(l({},e),{},{creative:t.creative,error:!1,isHidden:!1,isRotationEnabled:t.isRotationEnabled,isRotationPaused:!1,position:"FALLBACK_PROVIDER"!==t.providerName?e.position+1:e.position,providerName:t.providerName});case o.a.PAUSE_WALLPAPER_ROTATION:return l(l({},e),{},{isHidden:t.isHidden,isRotationPaused:!0});case o.a.RESUME_WALLPAPER_ROTATION:return l(l({},e),{},{isRotationPaused:!1});case o.a.WALLPAPER_BLOCKED_BY_CLIENT:return l(l({},e),{},{blockedByClient:!0});case o.a.WALLPAPER_ERROR:return l(l({},e),{},{error:!0})}return e}var c=a(9);c.a.injectReducer("wallpaper",p);var d=a(0),u=a.n(d),m=a(16),h=a(1131),v=a(825),w=a(11),g=a.n(w),_=a(14),f=a.n(_),E=a(155);const b={sendWallpaperImpressionHits(e){100*Math.random()>5||function(e){const t=e.providerName;E.a.send(["client_wallpaper_rotations",`wallpaper_${t.toLowerCase()}`])}(e)}};var y=a(74),P=a(7),O=a.n(P),R=a(132),k=a(100),A=a(659),C=a(144);function L(e){if(e){const t=e.getBoundingClientRect();return{x:Math.round(t.left),y:Math.round(t.top),width:Math.round(t.width),height:Math.round(t.height)}}return{x:0,y:0,width:0,height:0}}var N=a(17),W=a(10);const T=Date.now(),I={api_showDropZone(){const e=c.a.getState();!e.layout.dropzoneActive&&e.session.tandc&&c.a.dispatch(W.a.Layout.setDropZoneState(!0))},api_hideDropZone(){},api_toggleDragOver(){},api_addFiles(){},api_show(){c.a.dispatch(W.a.Layout.showUI())},api_hide(){c.a.dispatch(W.a.Layout.hideUI())},api_openPanel(e,t="",a=!1){var r,n,o,i,s;if(!e.match(/^\/(about|pro|products|sign-in|sign-up)/i))return;const{wallpaper:l,session:p}=c.a.getState(),d=null!==(r=null===l||void 0===l||null===(n=l.creative)||void 0===n?void 0:n.id)&&void 0!==r?r:"00",u=null!==(o=null===p||void 0===p?void 0:p.language)&&void 0!==o?o:"0",m=null!==(i=null===p||void 0===p||null===(s=p.region)||void 0===s?void 0:s.country)&&void 0!==i?i:"0",h=a?{search:`trk=${`wp_${d}_${m}_${u}`}`}:t?{search:`trk=${t}`}:{};N.a.navigateTo(e,!1,h)},api_pauseTimer(){c.a.dispatch(o.b.pauseRotation())},api_resumeTimer(){const{wallpaper:e}=c.a.getState();c.a.dispatch(o.b.startOrResumeRotation(e))},api_resetTimer(){R.a.reset()},api_change(){c.a.dispatch(o.b.rotateWallpaper())},api_forceChange(){c.a.dispatch(o.b.rotateWallpaper())},api_setWallpaperUIStyle(e={}){c.a.dispatch(W.a.Layout.setWallpaperUIStyle(e))},api_setAppTheme(e){document.body.className=`${document.body.className} ${e.className}`;const t=document.createElement("link");t.setAttribute("id",`wallpaper-theme-${e.className}`),t.setAttribute("rel","stylesheet"),t.setAttribute("type","text/css"),t.setAttribute("href",e.href),document.getElementsByTagName("head")[0].appendChild(t)},api_vast(e,t,a){A.a.track(a.vastTrackers,e,t)},api_getState(e){const{wallpaper:t}=c.a.getState();return this.getCurrentState(t.creative,e)},api_sendCustomEvent(e,t){C.a.track(t.customEvents,e)},api_sendCustomEventWalter(e,t){const{wallpaper:a,session:r}=c.a.getState(),n=a.position+1,o={event:e,creative:t,wallpaper:a,session:r,zoneId:k.a.calculateSlots(n)[0]};C.a.trackWalter(o)},getCurrentState(e,t){const{route:a,session:r,wallpaper:n}=c.a.getState(),o=n.position-1;return{_analytics:e.scripts,ads_viewed:o,requester:t,geo:r.region,state:a.path.match(/download/)?"download":"upload",panel:a.isPanelOpen,language:r.language,time_on_site:(Date.now()-T)/1e3,remaining:R.a.remainingTime||30,user_agent:O.a.identity,_click:f()(e,"meta.href"),position:L(document.querySelector(".transfer")||document.getElementById("transfer-pro")),nav_position:L(document.querySelector(".nav"))}}};var S=a(32);let D=null,$=null;function M(e){return new URL(e.src).origin}function j(e){if(M(D)!==e.origin)return!1;try{const{method:t,data:a,creative:r}=function({data:e}){let t={};try{t=e.raw?e:JSON.parse(e)}catch(r){throw new Error(`UnableToParseMessage: ${e}`)}if(!t.command)throw new Error(`EmptyWallpaperCommand: ${e}`);const a=`api_${t.command}`;if(!I[a])throw new Error(`MethodNotFound: ${a}`);return{method:a,data:t.data,creative:D||{}}}(e),n=null!==a&&void 0!==a&&a.length?[...a,r]:[...a],o=I[t](...n);"api_getState"===t&&x(o,"update")}catch(t){S.a.track(t)}}function x(e,t="start"){$.contentWindow.postMessage(function(e,...t){return JSON.stringify({command:e,data:t})}(t,e),M(D))}const U={init(e,t){D=t,$=e,window.addEventListener("message",j);x(I.getCurrentState(D))},stop(){$=null,D=null,window.removeEventListener("message",j)}},B={load(e){switch(e.format){case y.a.format.IMAGE:return this.loadImage(e.src);case y.a.format.HTML5:return this.loadHTML5();case y.a.format.VIDEO:return this.loadVideo(e.src);default:throw new Error(`UnsupportedCreativeType ${e.format}`)}},loadImage:e=>new Promise(((t,a)=>{const r=new Image;r.onload=()=>t(),r.onerror=e=>a(e),r.setAttribute("src",e)})),loadVideo(e){return new Promise(((t,a)=>{const r=this.getElement("video");r.onloadeddata=()=>{this.cleanUpElement(r),t()},r.onerror=e=>{this.cleanUpElement(r),a(e)},r.setAttribute("src",e),document.body.appendChild(r)}))},loadHTML5:()=>Promise.resolve(),getElement(e){const t=document.getElementById("element-preloader");t&&document.body.removeChild(t);const a=document.createElement(e);return a.setAttribute("id","element-preloader"),a.setAttribute("style","display: none"),a},cleanUpElement(e){document.body.removeChild(e),e=null}};function H(e){const t=new URL(window.location),a=e.match(/\?/)?"&":"?";return`${e}${a}_origin=${t.origin}`}var F=a(6);class V extends u.a.PureComponent{constructor(...e){super(...e),n()(this,"wrapperNode",u.a.createRef()),n()(this,"frameNode",u.a.createRef()),n()(this,"initWallpaper",(()=>{this.createTrackingTags(),U.init(this.frameNode.current,this.props.creative)}))}createTrackingTags(){const{creative:e}=this.props;if(!e.impressionTrackers)return null;e.impressionTrackers.forEach((e=>{const t=Object(F.a)(e);this.wrapperNode.current.appendChild(t)}))}render(){const{creative:e}=this.props;return u.a.createElement("div",{className:"wallpaper__html",ref:this.wrapperNode},u.a.createElement("iframe",{allow:"autoplay; camera",frameBorder:"0",onLoad:this.initWallpaper,ref:this.frameNode,scrolling:"no",src:H(e.src),title:"wallpaper-frame",id:"wallpaper-frame"}))}}var z=V;class K extends u.a.PureComponent{constructor(...e){super(...e),n()(this,"handleImageClick",(e=>{e.preventDefault();const{href:t}=this.props.creative.meta;if(!t)return;const a=window.open(t);a&&(a.opener=null)}))}render(){const{src:e,meta:t}=this.props.creative,a=g()("wallpaper__image",{"wallpaper--is-clickable":t.href});return u.a.createElement("div",{className:a,onClick:this.handleImageClick,onKeyPress:this.handleImageClick,role:"presentation",style:{backgroundImage:`url(${e})`}})}}var J=K;class q extends u.a.PureComponent{constructor(...e){super(...e),n()(this,"handleVideoClick",(e=>{e.preventDefault();const{href:t}=this.props.creative.meta;if(!t)return;const a=window.open(t);a&&(a.opener=null)}))}render(){const{src:e,meta:t}=this.props.creative,a=g()("wallpaper__video",{"wallpaper--is-clickable":t.href});return u.a.createElement("video",{className:a,onClick:this.handleVideoClick,onKeyPress:this.handleVideoClick,src:e,autoPlay:!0,muted:!0,loop:!0})}}var Z=q,G=a(30);a(1184);class Y extends u.a.PureComponent{constructor(...e){super(...e),n()(this,"state",{creative:null,position:0})}async componentDidMount(){const{route:e}=this.props;await this.props.rotateWallpaper(),e.isPanelOpen&&this.props.pauseRotation()}componentDidUpdate(e){const{route:t,wallpaper:a}=this.props,r=f()(t,"params.advert_id");r&&f()(e,"route.params.advert_id")!==r&&this.props.rotateWallpaper(),f()(e,"wallpaper.position")===a.position&&"FALLBACK_PROVIDER"!==a.providerName||this.preloadCreative(),a.isRotationEnabled&&!a.isHidden&&(e.route.isPanelOpen!==t.isPanelOpen&&t.isPanelOpen&&!a.isRotationPaused&&this.props.pauseRotation(),e.route.isPanelOpen!==t.isPanelOpen&&!t.isPanelOpen&&a.isRotationPaused&&this.props.startOrResumeRotation(a))}componentDidCatch(e){G.a.error(e),S.a.track(e),this.props.showFallbackWallpaper()}static getDerivedStateFromError(){return{creative:null}}async preloadCreative(){const{wallpaper:e}=this.props;try{U.stop(),await B.load(e.creative),this.setState({creative:e.creative,position:e.position}),b.sendWallpaperImpressionHits(e)}catch(t){S.a.track(t),this.props.showFallbackWallpaper()}}closePanel(){N.a.navigateTo(N.a.getLastRoute("transfer","/"))}renderWallpaperLink(){if(!this.state.creative.meta)return null;const{href:e,title:t}=this.state.creative.meta,a=t&&t.length>150?t.slice(0,150)+"...":t;return e&&t?u.a.createElement("a",{href:e,rel:"noopener noreferrer",className:"wallpaper__title",target:"_blank",title:t},a):t?u.a.createElement("span",{className:"wallpaper__title",title:t},a):null}renderBlockingLayer(){const{route:e}=this.props;return e.isPanelOpen?u.a.createElement("div",{className:"wallpaper__cover",onClick:this.closePanel,onKeyPress:this.closePanel,role:"link",tabIndex:"0"}):null}renderWallpaper(){const{creative:e}=this.state;switch(e.format){case y.a.format.IMAGE:return u.a.createElement(J,{creative:e});case y.a.format.HTML5:return u.a.createElement(z,{creative:e});case y.a.format.VIDEO:return u.a.createElement(Z,{creative:e})}}render(){const{route:e,dropzoneActive:t}=this.props,{creative:a,position:r}=this.state,n=g()("wallpaper",{"wallpaper--no-transition":!e.isPanelOpen,"wallpaper--half-panel":e.isPanelHalfOpen,"wallpaper--full-panel":e.isPanelFullOpen,"wallpaper--behind-dropzone":t});return u.a.createElement("div",{id:"wallpaper-container",className:n},this.renderBlockingLayer(),a&&u.a.createElement(h.a,{appear:!0,component:null},u.a.createElement(v.a,{key:`creative.src-${r}`,timeout:y.a.transition.duration,className:"wallpaper__content",classNames:{appear:"wallpaper__content--appear",appearActive:"wallpaper__content--appear-active",appearDone:"wallpaper__content--appear-done",enter:"wallpaper__content--enter",enterActive:"wallpaper__content--enter-active",enterDone:"wallpaper__content--enter-done",exit:"wallpaper__content--exit",exitActive:"wallpaper__content--exit-active",exitDone:"wallpaper__content--exit-done"}},u.a.createElement("div",null,this.renderWallpaper(),this.renderWallpaperLink()))))}}Y.defaultProps={wallpaper:{}};const Q={determineProviderAndRotate:o.b.determineProviderAndRotate,pauseRotation:o.b.pauseRotation,rotateWallpaper:o.b.rotateWallpaper,showFallbackWallpaper:o.b.showFallbackWallpaper,startOrResumeRotation:o.b.startOrResumeRotation};var X=Object(m.b)((({route:e,wallpaper:t,layout:{dropzoneActive:a}})=>({route:e,wallpaper:t,dropzoneActive:a})),Q)(Y)}}]);